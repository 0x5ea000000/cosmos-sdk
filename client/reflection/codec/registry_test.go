package codec

import (
	"encoding/hex"
	"testing"
)

const f1 = "0a27636f736d6f732f646973747269627574696f6e2f763162657461312f71756572792e70726f746f121b636f736d6f732e646973747269627574696f6e2e763162657461311a2a636f736d6f732f626173652f71756572792f763162657461312f706167696e6174696f6e2e70726f746f1a14676f676f70726f746f2f676f676f2e70726f746f1a1c676f6f676c652f6170692f616e6e6f746174696f6e732e70726f746f1a1e636f736d6f732f626173652f763162657461312f636f696e2e70726f746f1a2e636f736d6f732f646973747269627574696f6e2f763162657461312f646973747269627574696f6e2e70726f746f22140a125175657279506172616d735265717565737422580a135175657279506172616d73526573706f6e736512410a06706172616d7318012001280b32232e636f736d6f732e646973747269627574696f6e2e763162657461312e506172616d734204c8de1f005206706172616d7322560a27517565727956616c696461746f724f75747374616e64696e675265776172647352657175657374122b0a1176616c696461746f725f61646472657373180120012809521076616c696461746f72416464726573732284010a28517565727956616c696461746f724f75747374616e64696e6752657761726473526573706f6e736512580a077265776172647318012001280b32382e636f736d6f732e646973747269627574696f6e2e763162657461312e56616c696461746f724f75747374616e64696e67526577617264734204c8de1f00520772657761726473224e0a1f517565727956616c696461746f72436f6d6d697373696f6e52657175657374122b0a1176616c696461746f725f61646472657373180120012809521076616c696461746f72416464726573732285010a20517565727956616c696461746f72436f6d6d697373696f6e526573706f6e736512610a0a636f6d6d697373696f6e18012001280b323b2e636f736d6f732e646973747269627574696f6e2e763162657461312e56616c696461746f72416363756d756c61746564436f6d6d697373696f6e4204c8de1f00520a636f6d6d697373696f6e22eb010a1c517565727956616c696461746f72536c617368657352657175657374122b0a1176616c696461746f725f61646472657373180120012809521076616c696461746f724164647265737312270a0f7374617274696e675f686569676874180220012804520e7374617274696e6748656967687412230a0d656e64696e675f686569676874180320012804520c656e64696e6748656967687412460a0a706167696e6174696f6e18042001280b32262e636f736d6f732e626173652e71756572792e763162657461312e5061676552657175657374520a706167696e6174696f6e3a0888a01f0098a01f0122ba010a1d517565727956616c696461746f72536c6173686573526573706f6e736512500a07736c617368657318012003280b32302e636f736d6f732e646973747269627574696f6e2e763162657461312e56616c696461746f72536c6173684576656e744204c8de1f005207736c617368657312470a0a706167696e6174696f6e18022001280b32272e636f736d6f732e626173652e71756572792e763162657461312e50616765526573706f6e7365520a706167696e6174696f6e2283010a1d517565727944656c65676174696f6e5265776172647352657175657374122b0a1164656c656761746f725f61646472657373180120012809521064656c656761746f7241646472657373122b0a1176616c696461746f725f61646472657373180220012809521076616c696461746f72416464726573733a0888a01f00e8a01f00228d010a1e517565727944656c65676174696f6e52657761726473526573706f6e7365126b0a077265776172647318012003280b321c2e636f736d6f732e626173652e763162657461312e446563436f696e4233c8de1f00aadf1f2b6769746875622e636f6d2f636f736d6f732f636f736d6f732d73646b2f74797065732e446563436f696e73520772657761726473225b0a22517565727944656c65676174696f6e546f74616c5265776172647352657175657374122b0a1164656c656761746f725f61646472657373180120012809521064656c656761746f72416464726573733a0888a01f00e8a01f0022e6010a23517565727944656c65676174696f6e546f74616c52657761726473526573706f6e736512560a077265776172647318012003280b32362e636f736d6f732e646973747269627574696f6e2e763162657461312e44656c65676174696f6e44656c656761746f725265776172644204c8de1f0052077265776172647312670a05746f74616c18022003280b321c2e636f736d6f732e626173652e763162657461312e446563436f696e4233c8de1f00aadf1f2b6769746875622e636f6d2f636f736d6f732f636f736d6f732d73646b2f74797065732e446563436f696e735205746f74616c22580a1f517565727944656c656761746f7256616c696461746f727352657175657374122b0a1164656c656761746f725f61646472657373180120012809521064656c656761746f72416464726573733a0888a01f00e8a01f00224c0a20517565727944656c656761746f7256616c696461746f7273526573706f6e7365121e0a0a76616c696461746f7273180120032809520a76616c696461746f72733a0888a01f00e8a01f00225d0a24517565727944656c656761746f7257697468647261774164647265737352657175657374122b0a1164656c656761746f725f61646472657373180120012809521064656c656761746f72416464726573733a0888a01f00e8a01f00225c0a25517565727944656c656761746f72576974686472617741646472657373526573706f6e736512290a1077697468647261775f61646472657373180120012809520f7769746864726177416464726573733a0888a01f00e8a01f00221b0a195175657279436f6d6d756e697479506f6f6c526571756573742283010a1a5175657279436f6d6d756e697479506f6f6c526573706f6e736512650a04706f6f6c18012003280b321c2e636f736d6f732e626173652e763162657461312e446563436f696e4233c8de1f00aadf1f2b6769746875622e636f6d2f636f736d6f732f636f736d6f732d73646b2f74797065732e446563436f696e735204706f6f6c32d80f0a0551756572791298010a06506172616d73122f2e636f736d6f732e646973747269627574696f6e2e763162657461312e5175657279506172616d73526571756573741a302e636f736d6f732e646973747269627574696f6e2e763162657461312e5175657279506172616d73526573706f6e7365222b82d3e493022512232f636f736d6f732f646973747269627574696f6e2f763162657461312f706172616d731283020a1b56616c696461746f724f75747374616e64696e675265776172647312442e636f736d6f732e646973747269627574696f6e2e763162657461312e517565727956616c696461746f724f75747374616e64696e6752657761726473526571756573741a452e636f736d6f732e646973747269627574696f6e2e763162657461312e517565727956616c696461746f724f75747374616e64696e6752657761726473526573706f6e7365225782d3e4930251124f2f636f736d6f732f646973747269627574696f6e2f763162657461312f76616c696461746f72732f7b76616c696461746f725f616464726573737d2f6f75747374616e64696e675f7265776172647312e2010a1356616c696461746f72436f6d6d697373696f6e123c2e636f736d6f732e646973747269627574696f6e2e763162657461312e517565727956616c696461746f72436f6d6d697373696f6e526571756573741a3d2e636f736d6f732e646973747269627574696f6e2e763162657461312e517565727956616c696461746f72436f6d6d697373696f6e526573706f6e7365224e82d3e493024812462f636f736d6f732f646973747269627574696f6e2f763162657461312f76616c696461746f72732f7b76616c696461746f725f616464726573737d2f636f6d6d697373696f6e12d6010a1056616c696461746f72536c617368657312392e636f736d6f732e646973747269627574696f6e2e763162657461312e517565727956616c696461746f72536c6173686573526571756573741a3a2e636f736d6f732e646973747269627574696f6e2e763162657461312e517565727956616c696461746f72536c6173686573526573706f6e7365224b82d3e493024512432f636f736d6f732f646973747269627574696f6e2f763162657461312f76616c696461746f72732f7b76616c696461746f725f616464726573737d2f736c617368657312ed010a1144656c65676174696f6e52657761726473123a2e636f736d6f732e646973747269627574696f6e2e763162657461312e517565727944656c65676174696f6e52657761726473526571756573741a3b2e636f736d6f732e646973747269627574696f6e2e763162657461312e517565727944656c65676174696f6e52657761726473526573706f6e7365225f82d3e493025912572f636f736d6f732f646973747269627574696f6e2f763162657461312f64656c656761746f72732f7b64656c656761746f725f616464726573737d2f726577617264732f7b76616c696461746f725f616464726573737d12e8010a1644656c65676174696f6e546f74616c52657761726473123f2e636f736d6f732e646973747269627574696f6e2e763162657461312e517565727944656c65676174696f6e546f74616c52657761726473526571756573741a402e636f736d6f732e646973747269627574696f6e2e763162657461312e517565727944656c65676174696f6e546f74616c52657761726473526573706f6e7365224b82d3e493024512432f636f736d6f732f646973747269627574696f6e2f763162657461312f64656c656761746f72732f7b64656c656761746f725f616464726573737d2f7265776172647312e2010a1344656c656761746f7256616c696461746f7273123c2e636f736d6f732e646973747269627574696f6e2e763162657461312e517565727944656c656761746f7256616c696461746f7273526571756573741a3d2e636f736d6f732e646973747269627574696f6e2e763162657461312e517565727944656c656761746f7256616c696461746f7273526573706f6e7365224e82d3e493024812462f636f736d6f732f646973747269627574696f6e2f763162657461312f64656c656761746f72732f7b64656c656761746f725f616464726573737d2f76616c696461746f727312f7010a1844656c656761746f7257697468647261774164647265737312412e636f736d6f732e646973747269627574696f6e2e763162657461312e517565727944656c656761746f72576974686472617741646472657373526571756573741a422e636f736d6f732e646973747269627574696f6e2e763162657461312e517565727944656c656761746f72576974686472617741646472657373526573706f6e7365225482d3e493024e124c2f636f736d6f732f646973747269627574696f6e2f763162657461312f64656c656761746f72732f7b64656c656761746f725f616464726573737d2f77697468647261775f6164647265737312b5010a0d436f6d6d756e697479506f6f6c12362e636f736d6f732e646973747269627574696f6e2e763162657461312e5175657279436f6d6d756e697479506f6f6c526571756573741a372e636f736d6f732e646973747269627574696f6e2e763162657461312e5175657279436f6d6d756e697479506f6f6c526573706f6e7365223382d3e493022d122b2f636f736d6f732f646973747269627574696f6e2f763162657461312f636f6d6d756e6974795f706f6f6c424bc8e21e01d0e21e01e0e21e0190e31e00d0e31e00d8e31e005a316769746875622e636f6d2f636f736d6f732f636f736d6f732d73646b2f782f646973747269627574696f6e2f7479706573620670726f746f33"

func TestBuilder_Parse(t *testing.T) {
	f, err := newCosmosFetcher("localhost:9090")
	if err != nil {
		t.Fatal(err)
	}
	builder := NewFetcherRegistry(f)
	dec, err := hex.DecodeString(f1)
	if err != nil {
		t.Fatal(err)
	}
	_, err = builder.Parse(dec)
	if err != nil {
		t.Fatal(err)
	}

	t.Logf("%#v", builder)

	t.Logf("%#v", builder.ImportedFiles())
}
